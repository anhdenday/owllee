<!DOCTYPE html>
<html>

<head>
  <title>LMS VinSchool Assistant</title>
  <style>
    .full-screen-image {
      position: fixed;
      top: 0;
      left: 0;
      min-width: 100%;
      min-height: 100%;
    }

    /* Bong b√≥ng Edubot */
    #custom-edubot-bubble {
      position: fixed;
      right: 40px;
      bottom: 40px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: #FFF;
      color: #fff;
      box-shadow: 0 4px 16px #0005;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      z-index: 12000;
      transition: background 0.2s;
      user-select: none;
    }

    /* #custom-edubot-bubble:hover {
      background: #18459b;
    } */

    .edubot-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      /* border: 1px solid #3071FF; */
    }

    #custom-edubot-bubble .edubot-icon {
      font-size: 36px;
      margin-right: 6px;
    }

    .edubot-icon-close {
      font-size: 100px;
      width: 100px;
      height: 100px;
      font-weight: bold;
      color: #888;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 38px;
      height: 38px;
      border-radius: 50%;
      /* transition: background 0.18s, color 0.18s; */
      margin: 0 auto;
      cursor: pointer;
    }

    /* Menu ch·ªçn bot */
    #edubot-menu {
      position: fixed;
      right: 40px;
      bottom: 95px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 6px 32px #0003;
      padding: 12px 0;
      min-width: 220px;
      display: none;
      flex-direction: column;
      z-index: 13000;
      border: 1px solid #eee;
    }

    .edubot-menu-item {
      padding: 14px 20px;
      font-size: 16px;
      color: #3071FF;
      cursor: pointer;
      background: #fff;
      border: none;
      text-align: left;
      outline: none;
      transition: background 0.18s;
    }

    .edubot-menu-item:hover {
      background: #eaf2ff;
    }

    .edubot-menu-title {
      padding: 8px 20px;
      font-size: 16px;
      font-weight: bold;
      color: #000;
      margin-bottom: 10px;
      font-family: sans-serif;
      border-bottom: 1px solid #eee;
    }

    /* N√∫t ƒë√≥ng popup */
    #edubot-menu-close {
      position: absolute;
      top: 15px;
      right: 13px;
      font-size: 22px;
      color: #aaa;
      cursor: pointer;
      background: none;
      border-radius: 4px;
      border: none;
      z-index: 1;
    }

    #edubot-menu-close:hover {
      color: #f44336;
      background-color: #f9d5d1;
    }
  </style>
</head>

<body>
  <img src="https://github.com/anhdenday/owllee/blob/main/LMS/LMS.png?raw=true" class="full-screen-image"
    alt="LMS VinSchool Assistant">

  <!-- Bong b√≥ng Edubot -->
  <div id="custom-edubot-bubble" onclick="toggleMenu()">
    <!-- <span class="edubot-icon">ü§ñ</span> Edubot -->
    <img src="https://agent.owllee.io/resources/files/agent/avatar/27b7db7e511847acb32b6b2b7b6bea43.jpeg"
      alt="Edubot Avatar" class="edubot-avatar" />
  </div>

  <!-- Menu ch·ªçn bot -->
  <div id="edubot-menu">
    <button id="edubot-menu-close" onclick="closeMenu()">&times;</button>
    <div class="edubot-menu-title">Ch·ªçn tr·ª£ l√Ω Edubot</div>
    <button class="edubot-menu-item" onclick="selectBot('student')">Edubot - H·ªçc sinh</button>
    <button class="edubot-menu-item" onclick="selectBot('parent')">Edubot - Ph·ª• huynh</button>
  </div>

  <script>
    // C·∫•u h√¨nh bot
    const botConfigs = {
      student: {
        id: '68873896a5ab5e110336bd56'
      },
      parent: {
        id: '68898ff05799bf80be10a78a'
      }
    };

    // Tr·∫°ng th√°i menu
    function toggleMenu() {
      const menu = document.getElementById('edubot-menu');
      menu.style.display = (menu.style.display === "flex") ? "none" : "flex";
    }
    function closeMenu() {
      document.getElementById('edubot-menu').style.display = "none";
    }
    // Click ngo√†i menu s·∫Ω t·ª± ƒë√≥ng
    document.addEventListener('click', function (e) {
      const menu = document.getElementById('edubot-menu');
      const bubble = document.getElementById('custom-edubot-bubble');
      if (
        menu.style.display === "flex" &&
        !menu.contains(e.target) &&
        !bubble.contains(e.target)
      ) {
        menu.style.display = "none";
      }
    });

    let isPopupOpen = false;

    function setBubbleNormal() {
      const bubble = document.getElementById('custom-edubot-bubble');
      bubble.innerHTML = `
        <img
          src="https://agent.owllee.io/resources/files/agent/avatar/27b7db7e511847acb32b6b2b7b6bea43.jpeg"
          alt="Edubot Avatar"
          class="edubot-avatar"
        />
      `;
      bubble.style.background = "#fff";
      bubble.onclick = toggleMenu;
    }

    function setBubbleClose() {
      const bubble = document.getElementById('custom-edubot-bubble');
      bubble.innerHTML = `
        <svg width="32" height="32" viewBox="0 0 32 32">
          <line x1="10" y1="10" x2="22" y2="22" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
          <line x1="22" y1="10" x2="10" y2="22" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
        </svg>
      `;
      bubble.style.background = "#18459b";
      bubble.onclick = hideEdubotPopup;
    }

    function hideEdubotPopup() {
      document.querySelectorAll('.edubot-iframe').forEach(el => el.remove());
      isPopupOpen = false;
      setBubbleNormal();
    }

    // Xo√° bot c≈©
    function removeOwllaBot() {
      // Xo√° script
      document.querySelectorAll('script[data-chat-service]').forEach(el => el.remove());
      // Xo√° c√°c iframe ho·∫∑c div popup chatbot
      document.querySelectorAll('iframe[src*="agent.owllee.io"], .owlla-chatbot-bubble, .owlla-chatbot-container').forEach(el => el.remove());
    }

    // H√†m ·∫©n bong b√≥ng m·∫∑c ƒë·ªãnh Owllee (CSS ho·∫∑c x√≥a node)
    function hideDefaultOwllaBubble() {
      // CSS c·ª©ng ƒë·ªÉ ·∫©n m·ªçi bubble c·ªßa Owllee
      let css = `
      .owlla-chatbot-bubble,
      .owlla-chatbot-bubble *, 
      .owlla-chatbot-bubble[style] { display:none!important; opacity:0!important; pointer-events:none!important; }
      `;
      let style = document.getElementById('owlla-hide-bubble');
      if (!style) {
        style = document.createElement('style');
        style.id = 'owlla-hide-bubble';
        style.innerHTML = css;
        document.head.appendChild(style);
      }
      // Ngo√†i ra, x√≥a node bubble c·ª©ng n·∫øu c√≥
      setTimeout(() => {
        document.querySelectorAll('.owlla-chatbot-bubble').forEach(el => el.remove());
      }, 500);
    }

    // Load bot v√† m·ªü chat ngay, ·∫©n bubble m·∫∑c ƒë·ªãnh
    function selectBot(type) {
      closeMenu();
      removeOwllaBot();
      hideDefaultOwllaBubble();

      // T·∫°o iframe m·ªõi v·ªõi k√≠ch th∆∞·ªõc popup nh∆∞ c≈©
      const iframe = document.createElement('iframe');
      iframe.src = `https://agent.owllee.io/chatbot-iframe/${botConfigs[type].id}`;
      iframe.width = "450px";
      iframe.height = "600px";
      iframe.style.position = "fixed";
      iframe.style.right = "40px";
      iframe.style.bottom = "100px";
      iframe.style.zIndex = "10000";
      iframe.style.borderRadius = "16px";
      iframe.style.boxShadow = "0 4px 16px #0002";
      iframe.style.border = "none";
      iframe.className = "edubot-iframe";
      document.body.appendChild(iframe);

      isPopupOpen = true;
      setBubbleClose();
    }

    // KH√îNG load bot n√†o m·∫∑c ƒë·ªãnh, ch·ªâ hi·ªán bong b√≥ng Edubot t·ª± custom!
    // Khi ch·ªçn menu m·ªõi load + auto b·∫≠t chat
  </script>
</body>

</html>